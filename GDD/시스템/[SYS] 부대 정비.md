---
title: 부대 정비
category: 시스템
parent: [[GDD/시스템/[SYS] 턴제 전투 시스템]]
related:
  - [[GDD/UX/[UX] 루트 선택 UI]]
  - [[GDD/데이터/[DATA] 데이터 모델 가이드]]
---

## 상위/연관
- 상위: [[GDD/시스템/[SYS] 턴제 전투 시스템]]  
- 연관: [[GDD/UX/[UX] 루트 선택 UI]] · [[GDD/데이터/[DATA] 데이터 모델 가이드]]

---

## 상세 사양(병합 본문)

## 목적
- 루트 진입 전 캐릭터 선택/배치/장비/소모품 설정을 통해 전투 준비를 완료한다.

## 흐름
1) 루트 선택 화면에서 [부대 정비] 클릭  
2) 파티 슬롯 5명 구성(빈 슬롯 허용/미허용 옵션)  
3) 전열/후열 배치, 자동 편성/자동 장비  
4) 스킬 로드아웃(4슬롯) 선택  
5) 소모품/진형 프리셋 저장  
6) 준비 완료 후 루트 시작

## UI
- 좌: 보유 캐릭터 목록(필터: 역할, 레벨, 태그)
  - 각 행에 [추가]/[제외] 버튼 노출. 편성됨 → [제외](위험색), 미편성 → [추가]
  - 행 클릭 시 우측 정보 패널에 상세 표시
- 중앙: 진형 미리보기(전열/중열/후열 · 3×3 고정), 드래그 앤 드롭 배치·스왑
- 슬롯 상태 시각화: 빈 슬롯(.empty), 배치됨(.occupied), 드롭 가능(.droppable)로 스타일 구분
- 우: 캐릭터 정보 패널(스탯/스킬/장비/특성)
  - 표시 항목: 이름, HP/MP/SPD, ATK/DEF, 보유 스킬 아이콘(터치/클릭 시 상세)
  - 스킬 상세: 이름, 필요 MP, 명중률, 피해 계수×회수, 사거리(from→to), 유형
- 하단: 소모품 슬롯, 프리셋 저장/불러오기, [초기화]

## 규칙
- 3×3 슬롯 고정(전열/중열/후열 × 각 3칸)
- 중복 편성 불가(모든 아군 캐릭터는 유니크). 이미 편성된 경우 [제외]만 가능
- [추가] 동작: 전열→중열→후열 순으로 첫 빈칸 자동 배치
- 드래그 앤 드롭:
  - 목록→슬롯: 빈 슬롯에 배치(중복 방지)
  - 슬롯↔슬롯: 위치 스왑
  - 슬롯 클릭: 해당 슬롯 비우기
- 전투 반영 규칙:
  - 한 슬롯에는 반드시 한 유닛만 배치된다(중첩 금지)
  - 전투 진입 시 파티/포지션 스냅샷이 변경되었으면 전투 상태를 재생성하여 최신 배치 반영
  - 적군도 3×3 그리드 제약을 따른다. 동일 (row,col) 충돌 시 같은 행 내 다른 빈 열 → 다른 행 순으로 자동 재배치
- 배치 가능 랭크 제약(예: 궁수는 3~4열 권장)
- 스킬은 배치에 따라 사용 가능 여부가 달라짐
- 권장 전투력 미달 시 경고, 진입은 허용(옵션)
- 권장 전투력 산정: 단순 사칙연산 기반(예: 합/평균 → 추후 보정)

## 데이터 예시
```json
{
  "party": ["C-001","C-014","C-022",null,null],
  "positions": {"C-001": 1, "C-014": 2, "C-022": 3},
  "loadout": {"C-001": ["SK-01","SK-03","SK-05","SK-08"]},
  "consumables": {"slot1": "응급약", "slot2": "수류탄"}
}
```

## 검증 항목
- 배치/스킬 위치 제약 위반 방지  
- 중복 장비/소모품 규칙  
- 프리셋 저장/불러오기 정상 동작
